<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feeder Analytics | Dashboard</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .fade-rise {
      opacity: 0;
      transform: translateY(15px);
      animation: fadeRise 0.6s ease forwards;
    }
    @keyframes fadeRise {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Collapsible Sidebar */
    #sidebar {
      transition: width 0.25s ease, padding 0.25s ease;
    }
    #sidebar.collapsed {
      width: 80px !important;
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }
    #sidebar.collapsed .nav-label {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }
  </style>
</head>

<body class="bg-gradient-to-br from-slate-900 to-slate-700 min-h-screen text-white">

<!-- ğŸ”’ AUTH GUARD -->
<script type="module">

  const { data: auth } = await supabase.auth.getUser();
if (!auth?.user) {
  window.location.href = "/login.html";
  return;
}

const email = auth.user.email.toLowerCase();

// 1. Fetch user access record
const { data: allowed } = await supabase
  .from("allowed_users")
  .select("*")
  .eq("email", email)
  .maybeSingle();

// If not in allowlist â†’ deny
if (!allowed) {
  alert("You are not authorized to access this system.");
  await supabase.auth.signOut();
  window.location.href = "/login.html";
  return;
}

// If disabled â†’ deny
if (!allowed.enabled) {
  alert("Your access has been disabled.");
  await supabase.auth.signOut();
  window.location.href = "/login.html";
  return;
}

// Update last login
await supabase
  .from("allowed_users")
  .update({ last_login: new Date().toISOString() })
  .eq("email", email);

// Set role for use in UI
window.userRole = allowed.role;

  
  
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  const supabase = createClient(
    "https://ylkmlkelbpxyqauaqcfk.supabase.co",
    "sb_publishable_72WfxwzjZxDAQmSWVR3_3w_a58rn57e"
  );

  const { data: { session } } = await supabase.auth.getSession();

  if (!session) {
    window.location.href = "index.html";
  } else {
    const user = session.user;
    const name = user.user_metadata.full_name || user.email || "User";
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("username").textContent = name;
    });
  }

  // Logout
  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("logoutBtn").onclick = async () => {
      await supabase.auth.signOut();
      window.location.href = "index.html";
    };
  });
</script>

<!-- ğŸ§­ SIDEBAR -->
<aside
  id="sidebar"
  class="bg-white/10 backdrop-blur-xl border-r border-white/10 w-64 min-h-screen p-6 flex flex-col fixed top-0 left-0 transition-all duration-300"
>
  <!-- Toggle -->
  <button id="toggleSidebar"
    class="text-white mb-6 hover:bg-white/10 p-2 rounded-lg transition">
    â˜°
  </button>

  <!-- Logo -->
  <div class="flex items-center space-x-3 mb-10">
    <img src="assets/images/logo.png" class="h-10 w-auto" />
    <span class="text-xl font-bold nav-label">Feeder Analytics</span>
  </div>

  <!-- Nav -->
  <nav class="space-y-2">

    <a href="dashboard.html"
      class="flex items-center space-x-3 text-white/90 hover:bg-white/10 p-3 rounded-lg transition">
      <span class="text-lg">ğŸ </span>
      <span class="nav-label">Dashboard Overview</span>
    </a>

    <a href="feeder-review-dashboard.html"
      class="flex items-center space-x-3 text-white/90 hover:bg-white/10 p-3 rounded-lg transition">
      <span class="text-lg">ğŸ“Š</span>
      <span class="nav-label">Feeder Reviews</span>
    </a>

    <a href="#"
      class="flex items-center space-x-3 text-white/90 hover:bg-white/10 p-3 rounded-lg transition">
      <span class="text-lg">ğŸ’¡</span>
      <span class="nav-label">COS Insights</span>
    </a>

    <a href="#"
      class="flex items-center space-x-3 text-white/90 hover:bg-white/10 p-3 rounded-lg transition">
      <span class="text-lg">ğŸ«</span>
      <span class="nav-label">Campus Data</span>
    </a>

    <a href="#"
      class="flex items-center space-x-3 text-white/90 hover:bg-white/10 p-3 rounded-lg transition">
      <span class="text-lg">âš™ï¸</span>
      <span class="nav-label">Admin Tools</span>
    </a>

  </nav>
</aside>

<!-- ğŸ”¼ TOGGLE LOGIC -->
<script>
  document.getElementById("toggleSidebar").onclick = () => {
    const sidebar = document.getElementById("sidebar");
    sidebar.classList.toggle("collapsed");
  };
</script>


<!-- ğŸ”· TOP NAVBAR -->
<header class="ml-64 bg-white/10 backdrop-blur-xl border-b border-white/10 p-4 flex justify-between items-center shadow-lg fade-rise">
  <h1 class="text-xl font-semibold tracking-wide">Dashboard</h1>

  <div class="flex items-center gap-4">
    <span id="username" class="text-sm text-slate-300">Loading...</span>

    <button id="logoutBtn"
      class="px-3 py-1 rounded-lg bg-red-500/30 hover:bg-red-500/50 transition text-sm">
      Logout
    </button>

    <img src="https://ui-avatars.com/api/?name=STI"
      class="h-8 w-8 rounded-full border border-white/20" />
  </div>
</header>


<!-- ğŸ“Š MAIN CONTENT -->
<main class="ml-64 p-6 fade-rise">

  <div class="bg-white/10 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-lg">
    <h2 class="text-2xl font-bold mb-4">Welcome to Feeder Analytics</h2>
    <p class="text-slate-300 mb-4">
      This section will contain your dashboard charts, tables, and data visualizations.
    </p>

    <!-- Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      
      <div class="bg-white/5 p-6 rounded-xl border border-white/10">
        <h3 class="text-lg font-semibold mb-2">Enrolment Overview</h3>
        <p class="text-slate-400 text-sm">Chart placeholder</p>
      </div>

      <div class="bg-white/5 p-6 rounded-xl border border-white/10">
        <h3 class="text-lg font-semibold mb-2">Top Feeder Schools</h3>
        <p class="text-slate-400 text-sm">Chart placeholder</p>
      </div>

    </div>
  </div>

</main>

</body>
</html>
